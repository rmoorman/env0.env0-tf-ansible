version: 1

deploy:
  steps:
    terraformApply:
      after:
        - whoami
        - ls -lah
        - terraform output -raw private_key > myKey.pem
        - chmod 400 myKey.pem
        - sed -i "s/<placeholder_app>/$(terraform output -raw public_ip)/g" Ansible/inventory
        - apk update
        - apk install ansible
        - cd Ansible
        - ansible-playbook --private-key ../myKey.pem -i inventory jenkinsPlaybook.yaml